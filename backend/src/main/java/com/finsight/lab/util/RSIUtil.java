package com.finsight.lab.util;

import java.util.List;

public class RSIUtil {
	
	public static double calculateRSI(List<Double> closePrices, int period) {
		if (closePrices.size() < period + 1) {
			throw new IllegalArgumentException("Need at least " + (period + 1) + " prices to calculate RSI.");
		}

		double gainSum = 0, lossSum = 0;

		// Calculate initial average gains/losses
		for (int i = 1; i <= period; i++) {
			double change = closePrices.get(i - 1) - closePrices.get(i);
			if (change > 0) {
				gainSum += change;
			} else {
				lossSum += Math.abs(change);
			}
		}

		double avgGain = gainSum / period;
		double avgLoss = lossSum / period;

		// Calculate RSI
		for (int i = period; i < closePrices.size() - 1; i++) {
			double change = closePrices.get(i) - closePrices.get(i + 1);

			if (change > 0) {
				avgGain = ((avgGain * (period - 1)) + change) / period;
				avgLoss = ((avgLoss * (period - 1))) / period;
			} else {
				avgGain = (avgGain * (period - 1)) / period;
				avgLoss = ((avgLoss * (period - 1)) + Math.abs(change)) / period;
			}
		}

		double rs = avgLoss == 0 ? 100 : avgGain / avgLoss;
		return 100 - (100 / (1 + rs));
	}
}

/*
D1: 51.00  
D2: 50.50  
D3: 50.00  
D4: 49.50  
D5: 50.00  
D6: 51.50  
D7: 52.00  
D8: 51.00  
D9: 50.00  
D10: 49.50  
D11: 50.50  
D12: 51.00  
D13: 51.50  
D14: 52.50  
D15: 51.00  <-- Í∞ÄÏû• Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞

### **RSI Í≥ÑÏÇ∞ ÏòàÏ†ú (ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä)**  

**Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ (ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞Í∞Ä ÏïûÏóê Ïò¥, Ï¶â `ORDER BY DATE DESC`)**  
```
D1: 51.00  
D2: 50.50  
D3: 50.00  
D4: 49.50  
D5: 50.00  
D6: 51.50  
D7: 52.00  
D8: 51.00  
D9: 50.00  
D10: 49.50  
D11: 50.50  
D12: 51.00  
D13: 51.50  
D14: 52.50  
D15: 51.00  <-- Í∞ÄÏû• Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞
```
- **D1Ïù¥ Í∞ÄÏû• ÏµúÍ∑ºÏù¥Í≥†, D15Í∞Ä Í∞ÄÏû• Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞**  
- **Ï¶â, Î¶¨Ïä§Ìä∏ÏóêÏÑú `closePrices.get(0)`Ïù¥ Í∞ÄÏû• ÏµúÏã† Îç∞Ïù¥ÌÑ∞Ïù¥Í≥†, `closePrices.get(closePrices.size() - 1)`Ïù¥ Í∞ÄÏû• Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞**  

---

### **1. Ï¥àÍ∏∞ ÏÉÅÏäπÌè≠ / ÌïòÎùΩÌè≠ Í≥ÑÏÇ∞ (Ï≤òÏùå 14Ïùº)**
- D1: `51.00 ‚Üí 50.50` (ÌïòÎùΩ) ‚Üí -0.50  
- D2: `50.50 ‚Üí 50.00` (ÌïòÎùΩ) ‚Üí -0.50  
- D3: `50.00 ‚Üí 49.50` (ÌïòÎùΩ) ‚Üí -0.50  
- D4: `49.50 ‚Üí 50.00` (ÏÉÅÏäπ) ‚Üí +0.50  
- D5: `50.00 ‚Üí 51.50` (ÏÉÅÏäπ) ‚Üí +1.50  
- D6: `51.50 ‚Üí 52.00` (ÏÉÅÏäπ) ‚Üí +0.50  
- D7: `52.00 ‚Üí 51.00` (ÌïòÎùΩ) ‚Üí -1.00  
- D8: `51.00 ‚Üí 50.00` (ÌïòÎùΩ) ‚Üí -1.00  
- D9: `50.00 ‚Üí 49.50` (ÌïòÎùΩ) ‚Üí -0.50  
- D10: `49.50 ‚Üí 50.50` (ÏÉÅÏäπ) ‚Üí +1.00  
- D11: `50.50 ‚Üí 51.00` (ÏÉÅÏäπ) ‚Üí +0.50  
- D12: `51.00 ‚Üí 51.50` (ÏÉÅÏäπ) ‚Üí +0.50  
- D13: `51.50 ‚Üí 52.50` (ÏÉÅÏäπ) ‚Üí +1.00  
- D14: `52.50 ‚Üí 51.00` (ÌïòÎùΩ) ‚Üí -1.50  

**Ï¥ù ÏÉÅÏäπÌè≠ Ìï©Í≥Ñ (GainSum)** = 0.50 + 1.50 + 0.50 + 1.00 + 0.50 + 0.50 + 1.00 = `5.50`  
**Ï¥ù ÌïòÎùΩÌè≠ Ìï©Í≥Ñ (LossSum)** = 0.50 + 0.50 + 0.50 + 1.00 + 1.00 + 0.50 + 1.50 = `5.50`  

**ÌèâÍ∑† ÏÉÅÏäπÌè≠ (AvgGain)**
```
AvgGain = 5.50 / 14 = 0.3929
```
**ÌèâÍ∑† ÌïòÎùΩÌè≠ (AvgLoss)**
```
AvgLoss = 5.50 / 14 = 0.3929
```

---

### **2. Ï≤´ Î≤àÏß∏ RSI Í∞í Í≥ÑÏÇ∞**
```
RS = AvgGain / AvgLoss = 0.3929 / 0.3929 = 1.000
RSI = 100 - (100 / (1 + RS)) = 100 - (100 / (1 + 1.000))
RSI = 100 - (100 / 2) = 50.00
```

---

### **3. Îëê Î≤àÏß∏ Ïù¥ÌõÑ RSI Í∞í Í∞±Ïã† (D15 ‚Üí D1ÍπåÏßÄ Î∞òÎ≥µ)**
#### **D15 ‚Üí D1ÏúºÎ°ú Ïù¥ÎèôÌïòÎ©¥ÏÑú Îß§Ïùº RSI Í∞±Ïã†**
(ÏÉàÎ°úÏö¥ `gain`, `loss`Î•º Í∏∞Ï°¥ `AvgGain`, `AvgLoss`Ïóê Î∞òÏòÅ)
- ÎßåÏïΩ `Ïò§Îäò Í∞ÄÍ≤© - Ïñ¥Ï†ú Í∞ÄÍ≤© > 0`Ïù¥Î©¥ `AvgGain` ÏóÖÎç∞Ïù¥Ìä∏
- ÎßåÏïΩ `Ïò§Îäò Í∞ÄÍ≤© - Ïñ¥Ï†ú Í∞ÄÍ≤© < 0`Ïù¥Î©¥ `AvgLoss` ÏóÖÎç∞Ïù¥Ìä∏  

ÏòàÎ•º Îì§Ïñ¥ D14 ‚Üí D13ÏóêÏÑú `52.50 ‚Üí 51.00` (ÌïòÎùΩ `-1.50`)Ïù¥Î©¥:
```
AvgGain = (AvgGain * 13) / 14
AvgLoss = ((AvgLoss * 13) + 1.50) / 14
```
Ïù¥Î†áÍ≤å ÏÉàÎ°úÏö¥ Í∞íÏúºÎ°ú Í∞±Ïã†Îê®.  
Ïù¥ Í≥ºÏ†ïÏùÑ D15 ‚Üí D1ÍπåÏßÄ Î∞òÎ≥µÌï¥ÏÑú RSIÎ•º Îß§Ïùº Íµ¨ÌïòÍ≤å Îê®.

---

### **ÏµúÏ¢Ö ÏöîÏïΩ**
- **RSI Í≥ÑÏÇ∞ÏùÑ ÏúÑÌï¥ `15Í∞ú`Ïùò Í∞ÄÍ≤©Ïù¥ ÌïÑÏöîÌï®.**  
- **Í∞ÄÏû• ÏµúÏã† Îç∞Ïù¥ÌÑ∞(`D1`)Î∂ÄÌÑ∞ Í∞ÄÏû• Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞(`D15`)ÍπåÏßÄ 15Í∞úÎ•º Í∞ÄÏ†∏ÏôÄÏÑú RSI Í≥ÑÏÇ∞.**  
- **Ï≤´ Î≤àÏß∏ RSIÎäî 14ÏùºÍ∞Ñ ÌèâÍ∑† ÏÉÅÏäπ/ÌïòÎùΩÌè≠ÏùÑ Íµ¨Ìïú ÌõÑ Í≥ÑÏÇ∞.**  
- **Í∑∏ Ïù¥ÌõÑÏóêÎäî ÏÉàÎ°úÏö¥ Í∞ÄÍ≤© Î≥ÄÎèôÏùÑ Î∞òÏòÅÌïòÏó¨ `AvgGain`, `AvgLoss`Î•º Í≥ÑÏÜç Í∞±Ïã†.**  

Ïù¥Ï†ú **ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§ÄÏúºÎ°ú RSIÍ∞Ä Í≥ÑÏÇ∞ÎêòÎäî Î∞©Ïãù**Ïù¥ ÌôïÏã§Ìï¥Ï°åÏùÑ Í±∞Ïïº! üöÄ
 * */
